#!/usr/bin/env sh
set -eu
[ "{{ .chezmoi.os }}" = "darwin" ] || exit 0

# Install n (Node.js version manager) if not already present
# n is a simple Node.js version manager - alternative to nvm

if command -v n >/dev/null 2>&1; then
  echo "✅ n: already installed ($(n --version 2>/dev/null || echo 'installed'))"
  exit 0
fi

echo "➡️  Installing n (Node.js version manager)..."
echo "ℹ️  This will require sudo for the initial installation"

# Install n using the official installer script
# The script handles installation and PATH setup automatically
curl -L https://raw.githubusercontent.com/tj/n/master/bin/n -o /tmp/n-install
chmod +x /tmp/n-install

# Run the installer to install Node.js 20 (it will prompt for sudo if needed)
# The installer typically installs to /usr/local/bin/n
if sudo /tmp/n-install 20; then
  echo "✅ n installed successfully"
  echo "✅ Node.js 20 installed via n"
  echo "ℹ️  Use 'n' to manage Node.js versions:"
  echo "    n lts        # Install latest LTS"
  echo "    n latest     # Install latest version"
  echo "    n <version>  # Install specific version (e.g., n 20)"
  echo "    n            # List installed versions and select"
else
  echo "⚠️  n installation encountered an error."
  echo "ℹ️  You may need to install manually or check permissions"
fi

# Clean up
rm -f /tmp/n-install
